<!-- 2. DATA LOADED STATE -->
<template x-if="!isLoading">
    <div class="p-3 pb-5" style="margin-top: -35px; position: relative; z-index: 2;">

        <!-- 0. STATS BADGES (Moved here from Header) -->
        <div class="d-flex gap-2 overflow-auto pb-2 no-scrollbar mb-2">
            <div class="badge bg-white text-dark shadow-sm border px-3 py-2 rounded-pill d-flex align-items-center">
                <span class="text-muted small me-2">Flats</span>
                <span class="fw-bold fs-6" x-text="dashboardStats.flatsCount"></span>
            </div>
            <div class="badge bg-white text-dark shadow-sm border px-3 py-2 rounded-pill d-flex align-items-center">
                <span class="text-muted small me-2">Owners</span>
                <span class="fw-bold fs-6" x-text="dashboardStats.ownersCount"></span>
            </div>
            <div class="badge bg-white text-dark shadow-sm border px-3 py-2 rounded-pill d-flex align-items-center">
                <span class="text-muted small me-2">Tenants</span>
                <span class="fw-bold fs-6" x-text="dashboardStats.tenantsCount"></span>
            </div>
        </div>

        <!-- 1. FINANCIAL DASHBOARD -->
        <div class="card border-0 shadow-sm rounded-4 mb-4 bg-white overflow-hidden">
            <div class="card-body p-0">
                
                <!-- Total Collections Header -->
                <div class="p-4 bg-light bg-gradient border-bottom">
                    <div class="row g-3 text-center">
                         <div class="col-4 border-end">
                            <small class="text-muted text-uppercase fw-bold d-block mb-1" style="font-size: 0.6rem;">Total Collected</small>
                            <h5 class="fw-bold text-success mb-0" x-text="'₹' + dashboardStats.totalCollection.toLocaleString('en-IN')"></h5>
                         </div>
                         <div class="col-4 border-end">
                            <small class="text-muted text-uppercase fw-bold d-block mb-1" style="font-size: 0.6rem;">Total Spent</small>
                            <h5 class="fw-bold text-danger mb-0">₹0</h5>
                         </div>
                         <div class="col-4">
                            <small class="text-muted text-uppercase fw-bold d-block mb-1" style="font-size: 0.6rem;">Cash in Hand</small>
                            <h5 class="fw-bold text-primary mb-0">₹0</h5>
                         </div>
                    </div>
                </div>

                <!-- Breakdown List -->
                <div class="list-group list-group-flush">
                    
                    <!-- By Category -->
                    <div class="list-group-item p-4 border-light">
                        <div class="d-flex align-items-center mb-3">
                            <span class="text-muted small fw-bold text-uppercase">By Category</span>
                        </div>
                        
                        <!-- Monthly -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <div class="d-flex align-items-center">
                                     <i class="bi bi-building text-primary me-2"></i>
                                     <span class="text-dark fw-bold">Monthly Maintenance (Total)</span>
                                </div>
                                <span class="fw-bold text-dark" x-text="'₹' + dashboardStats.monthlyTotal.toLocaleString('en-IN')"></span>
                            </div>
                            <div class="ps-4 ms-1 border-start border-2 border-light">
                                <div class="ps-2 mt-2 mb-2"><small class="text-uppercase text-muted fw-bold" style="font-size: 0.65rem;">Last 3 Months</small></div>
                                <div class="d-flex justify-content-between align-items-center small mt-1 ps-2">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar-check-fill text-success me-2"></i>
                                        <span class="text-muted" x-text="dashboardStats.currentMonthLabel"></span>
                                    </div>
                                    <span class="fw-bold text-secondary" x-text="'₹' + dashboardStats.monthlyCurrent.toLocaleString('en-IN')"></span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center small mt-1 ps-2">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar-event-fill text-info me-2"></i>
                                        <span class="text-muted" x-text="dashboardStats.lastMonthLabel"></span>
                                    </div>
                                    <span class="fw-bold text-secondary" x-text="'₹' + dashboardStats.monthlyLast.toLocaleString('en-IN')"></span>
                                </div>
                                 <div class="d-flex justify-content-between align-items-center small mt-1 ps-2">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar-week-fill text-warning me-2"></i>
                                        <span class="text-muted" x-text="dashboardStats.prevPrevMonthLabel"></span>
                                    </div>
                                    <span class="fw-bold text-secondary" x-text="'₹' + dashboardStats.monthlyPrevPrev.toLocaleString('en-IN')"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Adhoc -->
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <div class="d-flex align-items-center">
                                     <i class="bi bi-stars text-warning me-2"></i>
                                     <span class="text-dark fw-bold">Adhoc / Other (Total)</span>
                                </div>
                                <span class="fw-bold text-info" x-text="'₹' + dashboardStats.adhocTotal.toLocaleString('en-IN')"></span>
                            </div>
                            <div class="ps-4 ms-1 border-start border-2 border-light">
                                <div class="ps-2 mt-2 mb-2"><small class="text-uppercase text-muted fw-bold" style="font-size: 0.65rem;">Last 3 Months</small></div>
                                <div class="d-flex justify-content-between align-items-center small mt-1 ps-2">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar-check-fill text-success me-2"></i>
                                        <span class="text-muted" x-text="dashboardStats.currentMonthLabel"></span>
                                    </div>
                                    <span class="fw-bold text-secondary" x-text="'₹' + dashboardStats.adhocCurrent.toLocaleString('en-IN')"></span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center small mt-1 ps-2">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar-event-fill text-info me-2"></i>
                                        <span class="text-muted" x-text="dashboardStats.lastMonthLabel"></span>
                                    </div>
                                    <span class="fw-bold text-secondary" x-text="'₹' + dashboardStats.adhocLast.toLocaleString('en-IN')"></span>
                                </div>
                                 <div class="d-flex justify-content-between align-items-center small mt-1 ps-2">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar-week-fill text-warning me-2"></i>
                                        <span class="text-muted" x-text="dashboardStats.prevPrevMonthLabel"></span>
                                    </div>
                                    <span class="fw-bold text-secondary" x-text="'₹' + dashboardStats.adhocPrevPrev.toLocaleString('en-IN')"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Payments -->
                    <div class="list-group-item p-4 border-light">
                        <div class="d-flex align-items-center mb-3">
                            <span class="text-muted small fw-bold text-uppercase">Recent Payments(s)</span>
                        </div>
                        <div class="ps-3 border-start border-2 border-warning ms-1">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-dark small">This Week</span>
                                <span class="fw-bold text-dark" x-text="'₹' + dashboardStats.receivedThisWeek.toLocaleString('en-IN')"></span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-dark small">This Month</span>
                                <span class="fw-bold text-dark" x-text="'₹' + dashboardStats.receivedThisMonth.toLocaleString('en-IN')"></span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-dark small">Last Month</span>
                                <span class="fw-bold text-dark" x-text="'₹' + dashboardStats.receivedLastMonth.toLocaleString('en-IN')"></span>
                            </div>
                             <div class="d-flex justify-content-between align-items-center">
                                <span class="text-dark small">Month Before</span>
                                <span class="fw-bold text-dark" x-text="'₹' + dashboardStats.receivedPrevPrevMonth.toLocaleString('en-IN')"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Validation -->
                    <div class="list-group-item p-4 border-light bg-warning bg-opacity-10 cursor-pointer" @click="view = 'validate'" style="cursor: pointer;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="d-block fw-bold text-dark mb-1">Pending Validation(s)</span>
                            </div>
                            <span class="fw-bold text-dark h4 mb-0" x-text="'₹' + dashboardStats.pendingValidationTotal.toLocaleString('en-IN')"></span>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Recent Transactions Header -->
            <div class="d-flex justify-content-between align-items-end mb-3 px-1">
                <h6 class="fw-bold text-dark mb-0">Recent Transactions (50)</h6>
                <button class="btn btn-link text-decoration-none small fw-bold p-0" @click.prevent="view = 'residents'">View All</button>
            </div>

            <!-- Transactions List -->
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="list-group list-group-flush">
                    <template x-for="(txn, index) in dashboardStats.recentTransactions" :key="txn.id">
                        <div class="list-group-item p-3 border-light position-relative" 
                             @click="openResidentByFlat(txn.flatNo)"
                             style="cursor: pointer; transition: background-color 0.2s;">
                            
                            <!-- Left Color Line -->
                            <div class="position-absolute top-0 start-0 bottom-0" 
                                 :class="index % 2 === 0 ? 'bg-primary' : 'bg-info'"
                                 style="width: 4px;"></div>

                            <div class="d-flex justify-content-between align-items-center ps-2">
                                <div class="d-flex align-items-start gap-3">
                                    <!-- Dynamic Icon -->
                                    <div class="rounded-circle d-flex align-items-center justify-content-center flex-shrink-0 mt-1" 
                                         style="width: 45px; height: 45px;"
                                         :class="txn.isMonthly ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'">
                                        <i class="bi fs-5" :class="txn.isMonthly ? 'bi-wallet-fill' : 'bi-cash-stack'"></i>
                                    </div>
                                    
                                    <div class="d-flex flex-column">
                                        <!-- Line 1: Type -->
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="fw-bold text-dark" style="font-size: 0.95rem;">
                                                <span x-text="txn.type"></span>
                                                <span x-show="txn.isMonthly"> - <span x-text="txn.displayPaymentFor.replace(' ', '-')"></span></span>
                                            </span>
                                            <!-- Method Badge -->
                                            <span class="badge bg-light text-secondary border px-2 py-1 d-flex align-items-center gap-1" style="font-size: 0.65rem;">
                                                <i class="bi bi-phone-flip" style="font-size: 0.7rem;"></i>
                                                <span x-text="txn.method"></span>
                                            </span>
                                        </div>

                                        <!-- Line 2: Flat + Name -->
                                        <div class="text-dark small fw-medium mt-1 d-flex align-items-center">
                                            <i class="bi bi-house-door-fill me-1" 
                                               :class="txn.payerType === 'Tenant' ? 'text-warning' : 'text-success'"></i> 
                                            
                                            <!-- Flat Number First -->
                                            <span class="fw-bold">Flat <span x-text="txn.displayFlat"></span></span>
                                            
                                            <!-- Separator & Name (If Known) -->
                                            <span x-show="txn.displayResidentName !== 'Unknown'" class="d-flex align-items-center">
                                                <span class="mx-1">-</span>
                                                <span x-text="txn.displayResidentName"></span>
                                            </span>

                                            <!-- Payer Badge -->
                                            <span class="badge rounded-pill border ms-2" 
                                                  :class="txn.payerType === 'Tenant' ? 'bg-warning bg-opacity-10 text-warning border-warning' : 'bg-success bg-opacity-10 text-success border-success'"
                                                  style="font-size: 0.6rem; text-transform: uppercase;"
                                                  x-text="txn.payerType">
                                            </span>
                                        </div>
                                        
                                        <!-- Line 3: Date -->
                                        <div class="text-muted small mt-1 d-flex align-items-center">
                                            <i class="bi bi-clock-fill me-1 text-primary"></i>
                                            <span x-text="txn.fullDateTime"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-end">
                                    <div class="fw-bold text-success fs-6" x-text="'+ ₹' + txn.amount"></div>
                                    <div class="mt-1">
                                        <span class="badge rounded-pill" 
                                              :class="txn.status.toLowerCase() === 'paid' ? 'bg-success' : 'bg-warning text-dark'" 
                                              style="font-size: 0.6rem;" x-text="txn.status"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <template x-if="dashboardStats.recentTransactions.length === 0">
                        <div class="p-4 text-center text-muted small">
                            No recent transactions found
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
</template>