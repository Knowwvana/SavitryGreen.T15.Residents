<template x-if="isLoading">
    <div class="p-3" style="margin-top: -50px; position: relative; z-index: 2;">
        <div class="card border-0 shadow-sm rounded-4 mb-4 bg-white">
            <div class="card-body p-4">
                <div class="skeleton-box mb-4" style="width: 100%; height: 20px;"></div>
                <div class="skeleton-box mb-4" style="width: 100%; height: 40px;"></div>
                <div class="skeleton-box mb-2" style="width: 100%; height: 40px;"></div>
            </div>
        </div>
    </div>
</template>

<template x-if="!isLoading">
    <div class="p-3 pb-5" style="margin-top: 5px; position: relative; z-index: 2;">

        <div class="card border-0 shadow-sm rounded-4 mb-3 bg-white overflow-hidden">
            <div class="card-body p-0">
                
                <div class="bg-light bg-gradient border-bottom py-2 text-center">
                    <span class="text-uppercase fw-bold text-muted" style="font-size: 0.65rem; letter-spacing: 1.2px;">Total Collections Till Date</span>
                </div>

                <div class="p-4">
                    <div class="row g-0 align-items-center mb-4">
                        <div class="col-6 text-center border-end">
                            <div class="d-flex align-items-center justify-content-center gap-1 mb-1">
                                <i class="bi bi-building-fill text-primary" style="font-size: 0.8rem;"></i>
                                <span class="text-muted small fw-bold">Monthly</span>
                            </div>
                            <h3 class="fw-bold text-dark mb-0" x-text="'₹' + dashboardStats.monthlyTotal.toLocaleString('en-IN')"></h3>
                        </div>
                        
                        <div class="col-6 text-center">
                            <div class="d-flex align-items-center justify-content-center gap-1 mb-1">
                                <i class="bi bi-stars text-warning" style="font-size: 0.8rem;"></i>
                                <span class="text-muted small fw-bold">Adhoc</span>
                            </div>
                            <h3 class="fw-bold text-dark mb-0" x-text="'₹' + dashboardStats.adhocTotal.toLocaleString('en-IN')"></h3>
                        </div>
                    </div>

                    <div class="position-relative mb-4">
                         <hr class="border-secondary opacity-10 my-0">
                         <span class="position-absolute top-50 start-50 translate-middle bg-white px-2 text-muted small fw-bold" style="font-size: 0.6rem;">NET STATUS</span>
                    </div>

                    <div class="row g-2">
                        <div class="col-6">
                            <div class="bg-danger bg-opacity-10 rounded-3 p-2 text-center border border-danger border-opacity-10">
                                <small class="d-block text-danger text-uppercase fw-bold mb-1" style="font-size: 0.6rem;">Total Expenditure</small>
                                <h5 class="fw-bold text-danger mb-0" x-text="'₹' + dashboardStats.totalSpent.toLocaleString('en-IN')"></h5>
                            </div>
                        </div>
                        
                        <div class="col-6">
                            <div class="bg-success bg-opacity-10 rounded-3 p-2 text-center border border-success border-opacity-10">
                                <small class="d-block text-success text-uppercase fw-bold mb-1" style="font-size: 0.6rem;">Cash in Hand</small>
                                <h5 class="fw-bold text-success mb-0" x-text="'₹' + dashboardStats.cashInHand.toLocaleString('en-IN')"></h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden bg-warning bg-opacity-10 cursor-pointer" 
             x-show="dashboardStats.pendingValidationTotal > 0"
             @click="view = 'validate'" 
             style="cursor: pointer;">
            <div class="card-body p-3 d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <div class="bg-white text-warning rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 35px; height: 35px;">
                         <i class="bi bi-hourglass-split"></i>
                    </div>
                    <div style="line-height: 1.2;">
                        <span class="d-block fw-bold text-dark small">Pending Validation</span>
                        <small class="text-muted" style="font-size: 0.65rem;">Tap to review</small>
                    </div>
                </div>
                <span class="fw-bold text-dark h6 mb-0" x-text="'₹' + dashboardStats.pendingValidationTotal.toLocaleString('en-IN')"></span>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-end mb-2 px-1">
            <h6 class="fw-bold text-dark mb-0">Recent Activity</h6>
            <button class="btn btn-link text-decoration-none small fw-bold p-0" @click.prevent="view = 'residents'" style="font-size: 0.75rem;">View All</button>
        </div>

        <div class="card border-0 shadow-sm rounded-4 overflow-hidden bg-white">
            <div class="list-group list-group-flush">
                <template x-for="(txn, index) in dashboardStats.recentTransactions" :key="txn.id">
                    <div class="list-group-item p-3 border-light position-relative" 
                            @click="openResidentByFlat(txn.flatNo)"
                            style="cursor: pointer;">
                        
                        <div class="position-absolute top-0 start-0 bottom-0" 
                                :class="index % 2 === 0 ? 'bg-primary' : 'bg-info'"
                                style="width: 4px;"></div>

                        <div class="d-flex justify-content-between align-items-center ps-2">
                            <div class="d-flex align-items-start gap-3">
                                <div class="rounded-circle d-flex align-items-center justify-content-center flex-shrink-0 mt-1" 
                                        style="width: 40px; height: 40px;"
                                        :class="txn.isMonthly ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'">
                                    <i class="bi fs-5" :class="txn.isMonthly ? 'bi-wallet-fill' : 'bi-cash-stack'"></i>
                                </div>
                                
                                <div class="d-flex flex-column">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="fw-bold text-dark small" style="font-size: 0.9rem;">
                                            <span x-text="(!txn.isMonthly && txn.title) ? txn.title : txn.type"></span>
                                            <span x-show="txn.isMonthly"> - <span x-text="txn.displayPaymentFor.replace(' ', '-')"></span></span>
                                        </span>
                                    </div>

                                    <div class="text-dark small fw-medium mt-0 d-flex align-items-center" style="font-size: 0.75rem;">
                                        <span class="fw-bold">Flat <span x-text="txn.displayFlat"></span></span>
                                        <span x-show="txn.displayResidentName !== 'Unknown'" class="mx-1 opacity-50">|</span>
                                        <span x-show="txn.displayResidentName !== 'Unknown'" x-text="txn.displayResidentName" class="text-truncate" style="max-width: 120px;"></span>
                                    </div>
                                    
                                    <div class="text-muted small mt-1 d-flex align-items-center gap-2" style="font-size: 0.7rem;">
                                        <span x-text="txn.fullDateTime"></span>
                                        <span class="badge bg-light text-secondary border px-1" style="font-size: 0.6rem;" x-text="txn.method"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-end">
                                <div class="fw-bold text-success" style="font-size: 0.95rem;" x-text="'+ ₹' + txn.amount"></div>
                                <span class="badge rounded-pill mt-1" 
                                        :class="txn.status.toLowerCase() === 'paid' ? 'bg-success' : 'bg-warning text-dark'" 
                                        style="font-size: 0.6rem;" x-text="txn.status"></span>
                            </div>
                        </div>
                    </div>
                </template>
                
                <template x-if="dashboardStats.recentTransactions.length === 0">
                    <div class="p-4 text-center text-muted small">
                        No recent transactions found
                    </div>
                </template>
            </div>
        </div>
    </div>
</template>